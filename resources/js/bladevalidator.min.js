(function(window){"use strict";class BladeValidator{constructor(formSelector,options ={}){this.form = document.querySelector(formSelector);if(!this.form){console.error(`BladeValidator:Form not found:${formSelector}`);return;}const detectedFramework = this.detectFramework();this.config ={request:options.request || null,endpoint:options.endpoint || "/bladevalidator/validate",csrfToken:options.csrfToken || this.getCsrfToken(),validateOn:options.validateOn || "blur",debounce:options.debounce || 300,framework:options.framework || "auto",errorClass:options.errorClass || this.getDefaultErrorClass(options.framework || detectedFramework),successClass:options.successClass || this.getDefaultSuccessClass(options.framework || detectedFramework),errorDisplay:options.errorDisplay || "default",onValidate:options.onValidate || null,onSuccess:options.onSuccess || null,onError:options.onError || null,};this.isValidating = false;this.errors ={};this.debounceTimers ={};this.init();}detectFramework(){const hasBootstrap = document.querySelector(".form-control")|| document.querySelector('[class*="bootstrap"]');if(hasBootstrap){return "bootstrap";}const hasTailwind = document.querySelector('[class*="rounded"]')|| document.querySelector('[class*="border"]')|| document.querySelector('[class*="text-"]');if(hasTailwind){return "tailwind";}return "none";}getDefaultErrorClass(framework){const classes ={bootstrap:"is-invalid",tailwind:"border-red-500",none:"error",};return classes[framework] || classes["none"];}getDefaultSuccessClass(framework){const classes ={bootstrap:"is-valid",tailwind:"border-green-500",none:"valid",};return classes[framework] || classes["none"];}init(){if(!this.config.request){console.error("BladeValidator:Request class is required");return;}this.attachEventListeners();}attachEventListeners(){const fields = this.form.querySelectorAll("input,select,textarea");fields.forEach((field)=>{if(!field.name)return;if(this.config.validateOn === "input"){field.addEventListener("input",(e)=>{this.handleFieldValidation(e.target);});}else if(this.config.validateOn === "blur"){field.addEventListener("blur",(e)=>{this.validateField(e.target.name,e.target.value);});}else if(this.config.validateOn === "change"){field.addEventListener("change",(e)=>{this.validateField(e.target.name,e.target.value);});}});}handleFieldValidation(field){const fieldName = field.name;if(this.debounceTimers[fieldName]){clearTimeout(this.debounceTimers[fieldName]);}this.debounceTimers[fieldName] = setTimeout(()=>{this.validateField(fieldName,field.value);},this.config.debounce);}async validateField(fieldName,fieldValue){this.isValidating = true;const formData = new FormData(this.form);const data ={};formData.forEach((value,key)=>{data[key] = value;});data._request = this.config.request;data._field = fieldName;data._token = this.config.csrfToken;try{const response = await fetch(this.config.endpoint,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":this.config.csrfToken,},body:JSON.stringify(data),});const result = await response.json();if(response.ok){this.clearFieldError(fieldName);this.markFieldAsValid(fieldName);if(this.config.onSuccess){this.config.onSuccess(fieldName);}}else if(response.status === 422){const errors = result.errors || ["Validation failed"];this.errors[fieldName] = errors;this.displayFieldError(fieldName,errors);if(this.config.onError){this.config.onError(fieldName,errors);}}else{console.error("BladeValidator:Unexpected response",response.status,result);}if(this.config.onValidate){this.config.onValidate(fieldName,result);}}catch(error){console.error("BladeValidator:Validation request failed",error);}finally{this.isValidating = false;}}displayFieldError(fieldName,errors){const field = this.form.querySelector(`[name="${fieldName}"]`);if(!field)return;field.classList.remove(this.config.successClass);field.classList.add(this.config.errorClass);if(this.config.errorDisplay === "none"){return;}const errorContainer = this.findOrCreateErrorContainer(field);if(errorContainer){errorContainer.textContent = errors[0];errorContainer.style.display = "block";if(this.config.framework === "bootstrap" || this.detectFramework()=== "bootstrap"){errorContainer.classList.add("invalid-feedback","d-block");}else if(this.config.framework === "tailwind" || this.detectFramework()=== "tailwind"){errorContainer.classList.add("text-red-500","text-sm","mt-1");}}}clearFieldError(fieldName){const field = this.form.querySelector(`[name="${fieldName}"]`);if(!field)return;field.classList.remove(this.config.errorClass);delete this.errors[fieldName];const errorContainer = this.findErrorContainer(field);if(errorContainer){errorContainer.textContent = "";errorContainer.style.display = "none";}}markFieldAsValid(fieldName){const field = this.form.querySelector(`[name="${fieldName}"]`);if(!field)return;field.classList.add(this.config.successClass);}findOrCreateErrorContainer(field){let container = this.findErrorContainer(field);if(container)return container;const framework = this.config.framework === "auto" ? this.detectFramework():this.config.framework;if(framework === "bootstrap"){container = document.createElement("div");container.className = "invalid-feedback";field.parentElement.appendChild(container);}else if(framework === "tailwind"){container = document.createElement("p");container.className = "text-red-500 text-sm mt-1";field.parentElement.appendChild(container);}else{container = document.createElement("div");container.className = "error-message";field.parentElement.appendChild(container);}return container;}findErrorContainer(field){const customTarget = field.getAttribute("data-error-target");if(customTarget){return document.querySelector(customTarget);}let container = field.parentElement.querySelector(".invalid-feedback");if(container)return container;let sibling = field.nextElementSibling;if(sibling && sibling.classList.contains("text-red-500")){return sibling;}container = field.parentElement.querySelector(".error");if(container)return container;container = field.parentElement.querySelector(".error-message");if(container)return container;return null;}getCsrfToken(){const metaTag = document.querySelector('meta[name="csrf-token"]');if(metaTag){return metaTag.getAttribute("content");}const tokenInput = this.form.querySelector('input[name="_token"]');if(tokenInput){return tokenInput.value;}console.warn("BladeValidator:CSRF token not found");return "";}async validateAll(){const fields = this.form.querySelectorAll("input,select,textarea");const promises = [];fields.forEach((field)=>{if(field.name){promises.push(this.validateField(field.name,field.value));}});await Promise.all(promises);return !this.hasErrors();}hasErrors(){return Object.keys(this.errors).length > 0;}getErrors(fieldName){return this.errors[fieldName] || [];}getAllErrors(){return this.errors;}clearAllErrors(){const fields = this.form.querySelectorAll("input,select,textarea");fields.forEach((field)=>{if(field.name){this.clearFieldError(field.name);field.classList.remove(this.config.successClass);}});this.errors ={};}enable(){this.attachEventListeners();}disable(){this.isValidating = false;}destroy(){Object.values(this.debounceTimers).forEach((timer)=> clearTimeout(timer));this.debounceTimers ={};this.clearAllErrors();}}BladeValidator.init = function(formSelector,options){return new BladeValidator(formSelector,options);};window.BladeValidator = BladeValidator;})(window);